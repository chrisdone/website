<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>hindent 5: One style to rule them all</title>
  <style>body {
  max-width: 40em;
  margin: .5in auto;
  font-size: 18px;
  font-family: serif;
  margin-top: 5em;
  line-height: 1.5;
}
pre, code {
  font-size: 16px;
}
pre {
  margin-left: 1.5em;
  line-height: 1.2;
}
a {
  color: #1a6e8e
}
.menu a {
  margin-right: 1em;
}
h1,h2,h3,h4,h5,h6 {
  font-family: Helvetica;
}

h1 a,h2 a,h3 a,h4 a {
  text-decoration: none;
  color: inherit;
}

.post-1,.post-2{
  margin-bottom: 0.5em;
}

.author {
  display: none;
}

footer {
  margin-top: 1.5em;
  padding-top: 1.5em;
  border-top: 1px solid #ccc;
  margin-bottom: 2em
}

footer span {
  display: none;
}

img {
  max-width: 100%
}
pre.sourceCode span.st {
  color: #366354
}
pre.sourceCode span.kw {
  color: #397460
}
pre.sourceCode span.fu {
  color: #8f4e8b
}
pre.sourceCode span.ot {
  color: #2e659c
}
pre.sourceCode span.dt {
  color: #4F4371
}
pre.sourceCode span.co {
  color: #666
}
  </style>
  </head>
  <body>
    <div class="page-wrap">
      <h1>hindent 5: One style to rule them all</h1>
<p class="author">By <a href="https://chrisdone.com/">Chris Done</a></p>

<h2 id="reminder-of-the-past">Reminder of the past</h2>
<p>In 2014, in <a href="https://chrisdone.com/posts/hindent">my last post</a> about <a href="https://github.com/chrisdone/hindent">hindent</a>, I wrote these points:</p>
<ol style="list-style-type: decimal">
<li><a href="https://chrisdone.com/posts/hindent#whats-the-deal-with-code-style">Automatic formatting is important</a>:</li>
</ol>
<ul>
<li><a href="https://chrisdone.com/posts/hindent#okay-but-is-this-a-problem-tooling-even-needs-to-solve">External tooling works better</a></li>
<li>Reading code is easier</li>
<li>Writing code is faster</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><a href="https://chrisdone.com/posts/hindent#is-this-really-an-issue-though">Other people also care about this</a></li>
<li><a href="https://www.reddit.com/r/haskell/comments/15gz8q/a_nondirty_shot_at_tabs_vs_spaces/">The Haskell community is not immune to code formatting debates</a></li>
</ol>
<p>I <a href="https://chrisdone.com/posts/hindent#a-practical-way-forward">proposed</a> my hindent tool, which:</p>
<ol style="list-style-type: decimal">
<li>Would format your code.</li>
<li>Supported multiple styles.</li>
<li>Supported further extension/addition of more styles trivially.</li>
</ol>
<h2 id="things-learned">Things learned</h2>
<p>I made some statements in that post that I’m going to re-evaluate in this post:</p>
<ol style="list-style-type: decimal">
<li>Let’s have a code style discussion. I propose to solve it with tooling.</li>
<li>It’s not practical to force everyone into one single style.</li>
</ol>
<h2 id="code-formatting-is-solved-with-tooling">Code formatting is solved with tooling</h2>
<p>I’ve used hindent for two years, it solves the problem. There are a couple exceptions<sup><a href="#fn1" class="footnoteRef" id="fnref1">1</a></sup>. On the whole, though, it’s a completely different working experience:</p>
<ul>
<li>Code always looks the same.</li>
<li>I don’t make <em>any</em> style decisions. I just think about the tree I need for my program.</li>
<li>I don’t do any manual line-breaking.</li>
<li>I’ve come to exploit it by writing lazy code like <code>do   x&lt;-getLine;when(x&gt;5)(print 5)</code> and then hitting a keybinding to reformat it.</li>
</ul>
<h2 id="switching-style-is-realistic">Switching style is realistic</h2>
<p>I’ve been writing Haskell in my own style for years. For me, my style is better for structured editing, more consistent, and visually easier to read, than most code I’ve seen. It’s like Lisp. Using hindent, with my ChrisDone style, I had it automatically formatted for me. I used 2-space indents.</p>
<p>The most popular style in the community<sup><a href="#fn2" class="footnoteRef" id="fnref2">2</a></sup> is JohanTibell: The alignment, line-breaking, and spacing (4 spaces instead of 2) differs significantly to my own style.</p>
<p>At FP Complete I’ve done a lot of projects, private FP Complete projects, client projects, and public FP Complete projects (like Stack). For the first year or so I generally stuck to my guns when working on code only I was going to touch and used my superior style.</p>
<p>But once the JohanTibell style in hindent was quite stable, I found that <strong>I didn’t mind</strong> using it while collaborating with people who prefer that style. The tooling made it so automatic, that I didn’t have to understand the style or make any style decisions, I just wrote code and got on with it. It doesn’t work great with structured-haskell-mode, but that’s ok. Eventually I got used to it, and eventually switched to using it for my own personal projects.</p>
<p>I completely did a U-turn. So I’m hoping that much of the community can do so too and put aside their stylistic preferences and embrace a standard.</p>
<h2 id="going-forward">Going forward</h2>
<p>hindent-5.* now supports <em>one style</em>, based on <a href="https://github.com/tibbe/haskell-style-guide/blob/master/haskell-style.md">the Johan Tibell style guide</a>. My <a href="https://github.com/chrisdone/haskell-style-guide">own style guide</a> is now deprecated in favor of that. The style flag <code>--style foo</code> is now silently ignored.</p>
<p>There is a <a href="https://chrisdone.com/hindent/">demonstration web site</a> in which you can try examples, and also get a link for the example to show other people the output (for debugging).</p>
<p>HIndent now has a “literate” test suite here: <a href="https://github.com/chrisdone/hindent/blob/master/TESTS.md">TESTS.md</a>. You can read through it as a document, a bit like Johan’s style guide. But running the test suite parses this file and checks that each code fence is printed as written.</p>
<p>There’s also a <a href="https://github.com/chrisdone/hindent/blob/master/BENCHMARKS.md">BENCHMARKS.md</a>, since I rewrote comment handling, switched to a bytestring-builder, improved the quadratic line-breaking algorithm to short-circuit, among other improvements, hindent now formats things in 1.5ms instead of 1s.</p>
<p>For those who still want to stick with their old hindent, Andrew Gibiansky is <a href="https://github.com/gibiansky/hindent">keeping a fork of hindent 4</a> for his personal use, and has said he’ll accept PR’s for that.</p>
<p>HIndent is not perfect, there’s always room for improvement (<a href="https://github.com/chrisdone/hindent/issues">issue tracker</a> welcomes issues), but over time that problem space gets smaller and smaller. There is support for Emacs, Vim and Atom. I would appreciate support for SublimeText too.</p>
<p>Give it a try!</p>
<div class="footnotes">
<hr></hr>
<ol>
<li id="fn1"><p>Such as CPP <code>#if</code> directives–they are tricky to handle. Comments are also tricky, but I’ve re-implemented comment handling from scratch and it works pretty well now. See the <a href="https://github.com/chrisdone/hindent/blob/master/TESTS.md#comments">pretty extensive tests</a>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>From a survey of the top downloaded 1000 packages on Hackage, 660 are 4-spaced and 343 are 2-spaced. All else being equal, 4 spaces wins.<a href="#fnref2">↩</a></p></li>
</ol>
</div>

<footer>
  © 2016-08-29 Chris Done &lt;chrisdone@gmail.com&gt;
<span style="float:right"><a href="../rss.xml">RSS</a></span>
</footer>

    </div>

  </body>
</html>
