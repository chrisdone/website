<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>‘amb’ operator and the list monad</title>
  <style>body {
  max-width: 40em;
  margin: .5in auto;
  font-size: 18px;
  font-family: serif;
  margin-top: 5em;
  line-height: 1.5;
}
pre, code {
  font-size: 16px;
}
pre {
  margin-left: 1.5em;
  line-height: 1.2;
}
a {
  color: #1a6e8e
}
.menu a {
  margin-right: 1em;
}
h1,h2,h3,h4,h5,h6 {
  font-family: Helvetica;
}

h1 a,h2 a,h3 a,h4 a {
  text-decoration: none;
  color: inherit;
}

.post-1,.post-2{
  margin-bottom: 0.5em;
}

.author {
  display: none;
}

footer {
  margin-top: 1.5em;
  padding-top: 1.5em;
  border-top: 1px solid #ccc;
  margin-bottom: 2em
}

footer span {
  display: none;
}

img {
  max-width: 100%
}
pre span.hs-string {
  color: #366354
}
pre span.hs-keyword {
  color: #397460
}
pre span.fu {
  color: #8f4e8b
}
pre span.ot {
  color: #2e659c
}
pre span.dt {
  color: #4F4371
}
pre span.hs-comment {
  color: #666
}
  </style>
  </head>
  <body>
    <div class="page-wrap">
      <h1>‘amb’ operator and the list monad</h1>
<p class="author">By <a href="https://chrisdone.com/">Chris Done</a></p>

<p>A friend was <a href="https://mihai.bazon.net/blog/amb-in-javascript/take-two">messing about with the <code>amb</code> operator</a> in JavaScript after seeing it in Common Lisp. The <code>amb</code> (or <em>ambiguous</em>) operator, first described by our pal John McCarthy (1967), and something I first <a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-28.html#%_sec_4.3">encountered in SICP.</a></p>
<p>These kind of constraint/logic puzzles seem naturally solved by the list monad, here’s an example of solving ‘Who owns the fish?’ Similar to <a href="https://en.wikipedia.org/wiki/Zebra_Puzzle">the Zebra puzzle.</a></p>
<pre><span class="hs-comment">-- Translation of</span>
<span class="hs-comment">-- <a href="https://mihai.bazon.net/blog/amb-in-javascript/take-two#wotf">http://mihai.bazon.net/blog/amb-in-javascript/take-two#wotf</a></span>

<span class="hs-keyword">import</span> <span class="hs-conid">Control</span><span class="hs-varop">.</span><span class="hs-conid">Monad</span>
<span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">Maybe</span>
<span class="hs-keyword">import</span> <span class="hs-conid">Data</span><span class="hs-varop">.</span><span class="hs-conid">List</span>

<span class="hs-definition">whoOwnsTheFish</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">addHouse</span> <span class="hs-conid">[]</span>

<span class="hs-definition">addHouse</span> <span class="hs-varid">houses</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">do</span>

  <span class="hs-varid">nat</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">other</span> <span class="hs-str">"nat"</span> <span class="hs-keyglyph">[</span><span class="hs-str">"British"</span><span class="hs-layout">,</span><span class="hs-str">"Swedish"</span><span class="hs-layout">,</span><span class="hs-str">"Danish"</span><span class="hs-layout">,</span><span class="hs-str">"Norwegian"</span>
                     <span class="hs-layout">,</span><span class="hs-str">"German"</span><span class="hs-keyglyph">]</span>
  <span class="hs-varid">col</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">other</span> <span class="hs-str">"col"</span> <span class="hs-keyglyph">[</span><span class="hs-str">"red"</span><span class="hs-layout">,</span><span class="hs-str">"green"</span><span class="hs-layout">,</span><span class="hs-str">"white"</span><span class="hs-layout">,</span><span class="hs-str">"yellow"</span><span class="hs-layout">,</span><span class="hs-str">"blue"</span><span class="hs-keyglyph">]</span>
  <span class="hs-varid">pet</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">other</span> <span class="hs-str">"pet"</span> <span class="hs-keyglyph">[</span><span class="hs-str">"dogs"</span><span class="hs-layout">,</span><span class="hs-str">"cats"</span><span class="hs-layout">,</span><span class="hs-str">"horses"</span><span class="hs-layout">,</span><span class="hs-str">"birds"</span><span class="hs-layout">,</span><span class="hs-str">"fish"</span><span class="hs-keyglyph">]</span>
  <span class="hs-varid">bev</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">other</span> <span class="hs-str">"bev"</span> <span class="hs-keyglyph">[</span><span class="hs-str">"tea"</span><span class="hs-layout">,</span><span class="hs-str">"milk"</span><span class="hs-layout">,</span><span class="hs-str">"coffee"</span><span class="hs-layout">,</span><span class="hs-str">"beer"</span><span class="hs-layout">,</span><span class="hs-str">"water"</span><span class="hs-keyglyph">]</span>
  <span class="hs-varid">tob</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">other</span> <span class="hs-str">"tob"</span> <span class="hs-keyglyph">[</span><span class="hs-str">"pallmall"</span><span class="hs-layout">,</span><span class="hs-str">"dunhill"</span><span class="hs-layout">,</span><span class="hs-str">"marlboro"</span>
                     <span class="hs-layout">,</span><span class="hs-str">"winfield"</span><span class="hs-layout">,</span><span class="hs-str">"rothmans"</span><span class="hs-keyglyph">]</span>

  <span class="hs-layout">(</span><span class="hs-varid">nat</span> <span class="hs-varop">==</span> <span class="hs-str">"British"</span><span class="hs-layout">)</span>  <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">col</span> <span class="hs-varop">==</span> <span class="hs-str">"red"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">nat</span> <span class="hs-varop">==</span> <span class="hs-str">"Swedish"</span><span class="hs-layout">)</span>  <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">pet</span> <span class="hs-varop">==</span> <span class="hs-str">"dogs"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">nat</span> <span class="hs-varop">==</span> <span class="hs-str">"Danish"</span><span class="hs-layout">)</span>   <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">bev</span> <span class="hs-varop">==</span> <span class="hs-str">"tea"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">col</span> <span class="hs-varop">==</span> <span class="hs-str">"white"</span><span class="hs-layout">)</span>    <span class="hs-varop">`iff`</span>
    <span class="hs-layout">(</span><span class="hs-varid">thisHouse</span> <span class="hs-varop">&gt;</span> <span class="hs-num">0</span> <span class="hs-varop">&amp;&amp;</span> <span class="hs-str">"col"</span> <span class="hs-varop">`lookup`</span> <span class="hs-layout">(</span><span class="hs-varid">houses</span><span class="hs-varop">!!</span><span class="hs-layout">(</span><span class="hs-varid">thisHouse</span> <span class="hs-comment">-</span> <span class="hs-num">1</span><span class="hs-layout">)</span><span class="hs-layout">)</span>
                       <span class="hs-varop">==</span> <span class="hs-conid">Just</span> <span class="hs-str">"green"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">col</span> <span class="hs-varop">==</span> <span class="hs-str">"green"</span><span class="hs-layout">)</span>    <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">bev</span> <span class="hs-varop">==</span> <span class="hs-str">"coffee"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">tob</span> <span class="hs-varop">==</span> <span class="hs-str">"pallmall"</span><span class="hs-layout">)</span> <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">pet</span> <span class="hs-varop">==</span> <span class="hs-str">"birds"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">col</span> <span class="hs-varop">==</span> <span class="hs-str">"yellow"</span><span class="hs-layout">)</span>   <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">tob</span> <span class="hs-varop">==</span> <span class="hs-str">"dunhill"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">thisHouse</span> <span class="hs-varop">==</span> <span class="hs-num">2</span><span class="hs-layout">)</span>    <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">bev</span> <span class="hs-varop">==</span> <span class="hs-str">"milk"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">thisHouse</span> <span class="hs-varop">==</span> <span class="hs-num">0</span><span class="hs-layout">)</span>    <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">nat</span> <span class="hs-varop">==</span> <span class="hs-str">"Norwegian"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">tob</span> <span class="hs-varop">==</span> <span class="hs-str">"winfield"</span><span class="hs-layout">)</span> <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">bev</span> <span class="hs-varop">==</span> <span class="hs-str">"beer"</span><span class="hs-layout">)</span>
  <span class="hs-layout">(</span><span class="hs-varid">nat</span> <span class="hs-varop">==</span> <span class="hs-str">"German"</span><span class="hs-layout">)</span>   <span class="hs-varop">`iff`</span> <span class="hs-layout">(</span><span class="hs-varid">tob</span> <span class="hs-varop">==</span> <span class="hs-str">"rothmans"</span><span class="hs-layout">)</span>

  <span class="hs-keyword">let</span> <span class="hs-varid">h</span> <span class="hs-keyglyph">=</span> <span class="hs-keyglyph">[</span><span class="hs-layout">(</span><span class="hs-str">"nat"</span><span class="hs-layout">,</span><span class="hs-varid">nat</span><span class="hs-layout">)</span><span class="hs-layout">,</span><span class="hs-layout">(</span><span class="hs-str">"bev"</span><span class="hs-layout">,</span><span class="hs-varid">bev</span><span class="hs-layout">)</span><span class="hs-layout">,</span><span class="hs-layout">(</span><span class="hs-str">"tob"</span><span class="hs-layout">,</span><span class="hs-varid">tob</span><span class="hs-layout">)</span><span class="hs-layout">,</span><span class="hs-layout">(</span><span class="hs-str">"pet"</span><span class="hs-layout">,</span><span class="hs-varid">pet</span><span class="hs-layout">)</span>
          <span class="hs-layout">,</span><span class="hs-layout">(</span><span class="hs-str">"col"</span><span class="hs-layout">,</span><span class="hs-varid">col</span><span class="hs-layout">)</span><span class="hs-keyglyph">]</span>
      <span class="hs-varid">a</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">houses</span> <span class="hs-varop">++</span> <span class="hs-keyglyph">[</span><span class="hs-varid">h</span><span class="hs-keyglyph">]</span>
  <span class="hs-keyword">if</span> <span class="hs-varid">length</span> <span class="hs-varid">a</span> <span class="hs-varop">==</span> <span class="hs-num">5</span>
     <span class="hs-keyword">then</span> <span class="hs-keyword">do</span> <span class="hs-varid">neighbors</span> <span class="hs-varid">a</span> <span class="hs-str">"tob"</span> <span class="hs-str">"marlboro"</span>  <span class="hs-str">"pet"</span> <span class="hs-str">"cats"</span>
             <span class="hs-varid">neighbors</span> <span class="hs-varid">a</span> <span class="hs-str">"pet"</span> <span class="hs-str">"horses"</span>    <span class="hs-str">"tob"</span> <span class="hs-str">"dunhill"</span>
             <span class="hs-varid">neighbors</span> <span class="hs-varid">a</span> <span class="hs-str">"nat"</span> <span class="hs-str">"Norwegian"</span> <span class="hs-str">"col"</span> <span class="hs-str">"blue"</span>
             <span class="hs-varid">neighbors</span> <span class="hs-varid">a</span> <span class="hs-str">"tob"</span> <span class="hs-str">"marlboro"</span>  <span class="hs-str">"bev"</span> <span class="hs-str">"water"</span>
             <span class="hs-varid">return</span> <span class="hs-varid">a</span>
     <span class="hs-keyword">else</span> <span class="hs-varid">addHouse</span> <span class="hs-varid">a</span>

  <span class="hs-keyword">where</span> <span class="hs-varid">other</span> <span class="hs-varid">typ</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">filter</span> <span class="hs-layout">(</span><span class="hs-varid">isNothing</span> <span class="hs-varop">.</span> <span class="hs-varid">findHouse</span> <span class="hs-varid">houses</span> <span class="hs-varid">typ</span><span class="hs-layout">)</span>
        <span class="hs-varid">thisHouse</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">length</span> <span class="hs-varid">houses</span>

<span class="hs-definition">findHouse</span> <span class="hs-varid">houses</span> <span class="hs-varid">typ</span> <span class="hs-varid">val</span> <span class="hs-keyglyph">=</span>
  <span class="hs-varid">fmap</span> <span class="hs-varid">fst</span> <span class="hs-varop">.</span> <span class="hs-varid">find</span> <span class="hs-layout">(</span><span class="hs-layout">(</span><span class="hs-varop">==</span><span class="hs-conid">Just</span> <span class="hs-varid">val</span><span class="hs-layout">)</span> <span class="hs-varop">.</span> <span class="hs-varid">lookup</span> <span class="hs-varid">typ</span> <span class="hs-varop">.</span> <span class="hs-varid">snd</span><span class="hs-layout">)</span> <span class="hs-varop">.</span> <span class="hs-varid">zip</span> <span class="hs-keyglyph">[</span><span class="hs-num">0</span><span class="hs-keyglyph">..</span><span class="hs-keyglyph">]</span>
   <span class="hs-varop">$</span> <span class="hs-varid">houses</span>

<span class="hs-definition">neighbors</span> <span class="hs-varid">houses</span> <span class="hs-varid">typ1</span> <span class="hs-varid">val1</span> <span class="hs-varid">typ2</span> <span class="hs-varid">val2</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">guard</span> <span class="hs-varop">$</span> <span class="hs-varid">diff</span> <span class="hs-varop">==</span> <span class="hs-conid">Just</span> <span class="hs-num">1</span>
  <span class="hs-keyword">where</span> <span class="hs-varid">diff</span> <span class="hs-keyglyph">=</span> <span class="hs-keyword">do</span> <span class="hs-varid">h1</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">findHouse</span> <span class="hs-varid">houses</span> <span class="hs-varid">typ1</span> <span class="hs-varid">val1</span>
                  <span class="hs-varid">h2</span> <span class="hs-keyglyph">&lt;-</span> <span class="hs-varid">findHouse</span> <span class="hs-varid">houses</span> <span class="hs-varid">typ2</span> <span class="hs-varid">val2</span>
                  <span class="hs-varid">return</span> <span class="hs-varop">$</span> <span class="hs-varid">abs</span> <span class="hs-varop">$</span> <span class="hs-varid">h1</span> <span class="hs-comment">-</span> <span class="hs-varid">h2</span>

<span class="hs-definition">iff</span> <span class="hs-varid">x</span> <span class="hs-varid">y</span> <span class="hs-keyglyph">=</span> <span class="hs-varid">guard</span> <span class="hs-varop">$</span> <span class="hs-varid">x</span> <span class="hs-varop">==</span> <span class="hs-varid">y</span></pre>

<footer>
  © 2011-04-10 Chris Done &lt;chrisdone@gmail.com&gt;
<span style="float:right"><a href="../rss.xml">RSS</a></span>
</footer>

    </div>

  </body>
</html>
