<!doctype html>
<html>
  <head>
    <style>
      body {
          max-width: 60em;
          margin: .5in auto;
          font-size: 18px;
          font-family: serif;
          line-height: 1.5;
      }
      h1,h2,h3,h4,h5,h6 {
          font-family: Helvetica;
      }
      code { background: #eee; border: #aaa; border-radius: 3px;
             padding: 0.2em 0.5em }
      h1 a,h2 a,h3 a,h4 a {
          color: inherit;
      }
      @media(max-width:767px){
          body { margin: 1px 4px; }
          h1, h2, .menu { margin: 0; }
          h1 { font-size: 1.5em; }
          h2 { font-size: 1.125em; }
          h3 { font-size: 1.0125em; }
      }
      .slides { display: flex; flex-direction: column; row-gap: 2em }
      .slide { display: flex; flex-direction: row; column-gap: 2em; }
      .slide p { line-height: 1.8em; }
      .slide a {
          text-decoration: none;
      }
      .slide p a { text-decoration: underline }
      .slide img {
          width: 20em; border: 1px solid #ddd; border-radius: 3px;
          box-shadow: 0.1em 0.1em 0.1em 0.1em rgba(100, 100, 100, .1);
      }
      .slide p:first-child {
          margin-top: 0;
      }
      .date { margin-bottom: 2em; padding-top: 0em; }
    </style>
  </head>
  <body>
    <h1>A Tour of Hell</h1>
    <p class="date"><em>Feb 9th 2024</em></p>
    <div class="slides">
      <div class="slide">
        <a href="slide-9.png"><img src="slide-9.png"></a>
        <div>
          <p>This set of slides sketches out the solution, as an
            implementation, in technical detail.</p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-11.png"><img src="slide-11.png"></a>
        <div>
          <p>There are a few limits on the language; no imports, no
            polymorphism (poly types) i.e. no declaration is ever
            inferred with a <code>forall a.</code> in it. Poly types are
            awesome, but they make the implementation harder, and are a
            form of abstraction that you might not need in a scripting
            language. I don't need them in my case, YMMV.
          </p>
          <p>
            No imports: instead, all names that usually come under a
            package name like <code>async</code>
            become <code>Async.race</code>, <code>List.map</code>,
            etc. All identifiers are explicitly qualified except
            lambda parameters: <code>\x -> x</code> -- not qualified.
          </p>
          <p>
            Recursion is completely ruled out, but <code>fix</code>
            works fine, so you still have it as a primitive
            function. It's just not something you can produce
            yourself.
          </p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-15.png"><img src="slide-15.png"></a>
        <div>
          <p>
            Rather than bothering to implement a parser, I used
            haskell-src-exts. That package isn't really maintained
            anymore, but I'm kind of used to it now, and GHC's parser is
            a bit too wordy for me.
          </p>
          <p>
            Re-using a parser is usually wise, parsing layout in Haskell
            is fiddly and I just wanted something that works as I'm used
            to.
          </p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-16.png"><img src="slide-16.png"></a>
        <div>
          <p>
            What's the next step? Well, we have to <em>desugar</em>
            this syntax into something
            smaller. <code>do</code>-notation becomes
            nested <code>>>=</code> calls, etc.
          </p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-17.png"><img src="slide-17.png"></a>
        <div>
          <p>
            But before we do that, let's stop. We're currently at the
            beginning of the pipeline: parsing. For this project, a
            primary concern was to make the evaluator as lean as
            possible, and, ideally,
            <a href="https://en.wikipedia.org/wiki/Partial_function">total</a>
            and complete. So I want to start at the interpreter and
            then work backwards from there. What does a trivial but
            total evaluator look like in Haskell?
          </p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-18.png"><img src="slide-18.png"></a>
        <div>
          <p>
            Here's a basic one. It's called "higher-order abstract
            syntax" because you've got syntax productions that take
            functions as arguments. Rather than carrying an
            environment around, like in,
            e.g. <a href="https://norvig.com/lispy.html">How to Write
            a (Lisp) Interpreter (in Python)</a>, you store a
            function <em>as a real function</em>. When you pass an
            environment around, you tend to have a lookup function
            that could throw an error if you got your evaluator wrong.
          </p>
          <p>
            This evaluator is <em>total</em> and won't crash. This is
            really neat and tidy. The only downside really is that
            it's opaque. It's hard to work with functions, because you
            can't look inside them once you've made them. You also
            can't smooth out the wrinkles inside them, at least, as
            far as I'm aware. I've heard of cunning approaches to do
            so, but some things are best left alone.
          </p>
          <p>
            Let's consider another approach.
          </p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-19.png"><img src="slide-19.png"></a>
        <div>
          <p>
            I encountered this approach while perusing Oleg Kiselyov's
            <a href="https://okmij.org/ftp/tagless-final/course/lecture.pdf"><em>Typed Tagless Final Interpreters</em></a> paper and he dropped in
            this example like it was the most normal thing in the world.
          </p>
        </div>
      </div class="slide">
      <div class="slide">
        <a href="slide-20.png"><img src="slide-20.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-21.png"><img src="slide-21.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-22.png"><img src="slide-22.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-23.png"><img src="slide-23.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-24.png"><img src="slide-24.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-25.png"><img src="slide-25.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-26.png"><img src="slide-26.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-27.png"><img src="slide-27.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-28.png"><img src="slide-28.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-29.png"><img src="slide-29.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-30.png"><img src="slide-30.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-31.png"><img src="slide-31.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-32.png"><img src="slide-32.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-33.png"><img src="slide-33.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-34.png"><img src="slide-34.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-35.png"><img src="slide-35.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-36.png"><img src="slide-36.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-37.png"><img src="slide-37.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-38.png"><img src="slide-38.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-39.png"><img src="slide-39.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-40.png"><img src="slide-40.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-41.png"><img src="slide-41.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-42.png"><img src="slide-42.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-43.png"><img src="slide-43.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-44.png"><img src="slide-44.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-45.png"><img src="slide-45.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-46.png"><img src="slide-46.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-47.png"><img src="slide-47.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-48.png"><img src="slide-48.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-49.png"><img src="slide-49.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-50.png"><img src="slide-50.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-51.png"><img src="slide-51.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-52.png"><img src="slide-52.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-53.png"><img src="slide-53.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-54.png"><img src="slide-54.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-55.png"><img src="slide-55.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-56.png"><img src="slide-56.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-57.png"><img src="slide-57.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-58.png"><img src="slide-58.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-59.png"><img src="slide-59.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-60.png"><img src="slide-60.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-61.png"><img src="slide-61.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-62.png"><img src="slide-62.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-63.png"><img src="slide-63.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-64.png"><img src="slide-64.png"></a>
      </div class="slide">
      <div class="slide">
        <a href="slide-65.png"><img src="slide-65.png"></a>
      </div class="slide">
    </div>
  </body>
